{%load static %}

<!DOCTYPE html>
<html>
    <head>
        <title>Log</title>
        
        <!--jquery-->
        <script
          src="https://code.jquery.com/jquery-3.1.1.min.js"
          integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
          crossorigin="anonymous"></script>
        <script src="{% static 'js/ansi_up.js' %}" type="text/javascript"></script>
    </head>
    <body style="background-color: #000000;">
        <div id="logCode">
            
        </div>
        <div id="loadingGif" align="center">
            <img src="{% static 'images/Spinner-1s-200px.gif' %}" />
        </div>
        <script>
            var timeoutID = null;
            var close = false;
            
            function getLog(url, cb){
                $.ajax({
                    url: "{% url 'log' %}?log={{ logFileName }}",
                    type: 'GET',
                    success: function(data){
                        if (close){
                            // close setInterval
                            $("html, body").animate({ scrollTop: $(document).height() }, 0);
                            window.clearInterval(timeoutID);
                            timeoutID = null;
                            return 
                        }
                        
                        $("#logCode").html("");
                        var ansiUp = new AnsiUp;
                        
                        data.log.forEach(function(item, index) {
                            
                            var html = ansiUp.ansi_to_html(item);
                            html = html.replace(/;nbsp;/g, "<span>&nbsp;</span>");
                            $("#logCode").append($("<span style=\"color: white;\">" + html + "</span><br/>"));
                        })
                        
                        if (data.end){
                            $("#loadingGif").hide();
                            close = true;
                        }
                        $("html, body").animate({ scrollTop: $(document).height() }, 0);
                        
                    },
                });
            }
            
            getLog();
            timeoutID = window.setInterval(getLog, 1000);  
        </script>
    </body>
</html>